name: sync-fork
run-name: 'Auto sync fork repositories by the event ${{ github.event_name }}'
on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch: { }
  push:
    branches: master
    paths:
      - '.github/workflows/auto-sync-fork.yaml'

# TODO: Array of forks
jobs:
  sync:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        repo:
          - 'derskythe/flipperzero-subbrute' 
          - 'derskythe/libuv'
          - 'derskythe/mlib' 
          - 'derskythe/emv-utils'
          - 'derskythe/IOTstack'
          - 'derskythe/SoapCore'
        include:
          - repo: 'derskythe/flipperzero-subbrute'
            branch: 'master'
          - repo: 'derskythe/libuv'
            branch: 'v1.x'
          - repo: 'derskythe/mlib'
            branch: 'master'
          - repo: 'derskythe/emv-utils'
            branch: 'master'
          - repo: 'derskythe/IOTstack'
            branch: 'master'
          - repo: 'derskythe/SoapCore'
            branch: 'master'
    permissions:
      contents: write
    steps:
      - run: gh repo sync ${{ matrix.repo }} -b ${{ matrix.branch }}
        env:
          GITHUB_TOKEN: ${{ secrets.METRICS_TOKEN }}
